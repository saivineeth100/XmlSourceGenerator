# Diagnostics

The XmlSourceGenerator includes a Roslyn Analyzer to help you detect common usage mistakes and performance pitfalls.

## Index

| ID | Title | Severity | Description |
|---|---|---|---|
| [XSG001](#xsg001-class-must-be-partial) | Class must be partial | Error | Classes marked with `[XmlAutoGenerated]` must be declared as `partial`. |
| [XSG002](#xsg002-class-must-have-parameterless-constructor) | Class must have parameterless constructor | Error | Classes marked with `[XmlAutoGenerated]` must have a public parameterless constructor. |
| [XSG003](#xsg003-xmlattribute-used-on-complex-type) | [XmlAttribute] used on complex type | Error | `[XmlAttribute]` cannot be used on complex types. |
| [XSG004](#xsg004-xmlstreamlistelement-used-on-non-collection-type) | [XmlStreamListElement] used on non-collection type | Error | `[XmlStreamListElement]` implies a collection but was applied to a non-collection property. |
| [XSG005](#xsg005-duplicate-xml-name) | Duplicate XML name | Error | Multiple properties are mapped to the same XML element or attribute name. |
| [XSG006](#xsg006-reflection-fallback-used) | Reflection fallback used | Warning | A complex property is not source-generated and will use reflection at runtime. |

---

## XSG001: Class must be partial

To generate source code that augments your class, strict partiality is required.

**Example of invalid code:**
```csharp
[XmlAutoGenerated]
public class MyClass { } // Error XSG001
```

**Fix:**
```csharp
[XmlAutoGenerated]
public partial class MyClass { }
```

---

## XSG002: Class must have parameterless constructor

The generator creates code that instantiates your class during deserialization using `new MyClass()`.

**Example of invalid code:**
```csharp
[XmlAutoGenerated]
public partial class MyClass 
{
    public MyClass(string arg) { } // Error XSG002
}
```

**Fix:**
```csharp
[XmlAutoGenerated]
public partial class MyClass 
{
    public MyClass() { }
    public MyClass(string arg) { }
}
```

---

## XSG003: [XmlAttribute] used on complex type

XML attributes can only contain simple string values. Complex objects must be mapped to XML elements.

**Invalid:**
```csharp
public class Child { }

[XmlAutoGenerated]
public partial class Parent
{
    [XmlAttribute]
    public Child ChildProp { get; set; } // Error XSG003
}
```

**Fix:**
Remove `[XmlAttribute]` (defaults to Element) or change property type to a simple type.

---

## XSG004: [XmlStreamListElement] used on non-collection type

`[XmlStreamListElement]` is used for streaming collections.

**Invalid:**
```csharp
[XmlStreamListElement]
public int MyProp { get; set; } // Error XSG004
```

**Fix:**
Use it on `List<T>`, `IEnumerable<T>`, or arrays.

---

## XSG005: Duplicate XML name

The generator cannot decide which property to map if multiple properties share the same XML name.

**Invalid:**
```csharp
[XmlElement("Name")]
public string FirstName { get; set; }

[XmlElement("Name")]
public string LastName { get; set; } // Error XSG005
```

---

## XSG006: Reflection fallback used

When a property involves a complex type that is NOT marked with `[XmlAutoGenerated]` and does not implement `IXmlStreamable`, the generator falls back to using reflection at runtime. This works but is slower than generated code.

**Warning Example:**
```csharp
public class ExternalType { public int Id { get; set; } }

[XmlAutoGenerated]
public partial class MyClass
{
    public ExternalType MyProp { get; set; } // Warning XSG006: 'ExternalType' uses reflection fallback.
}
```

**Fix:**
If you own the type, mark it with `[XmlAutoGenerated]`.

```csharp
[XmlAutoGenerated]
public partial class ExternalType { public int Id { get; set; } }
```

If you do not own the type (e.g. third-party library), you can ignore this warning if performance is not critical, or create a wrapper class that uses generated serialization.
